{% extends "user.html" %}

{% block title %}Server Error - Africoin{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6 text-center">
            <!-- Error Illustration -->
            <div class="mb-4">
                <i class="bi bi-exclamation-triangle display-1 text-warning"></i>
            </div>

            <!-- Error Message -->
            <div class="error-content">
                <h1 class="display-4 fw-bold text-dark mb-3">500</h1>
                <h2 class="h3 text-muted mb-4">Internal Server Error</h2>
                
                <p class="lead text-muted mb-4">
                    Something went wrong on our end. Our technical team has been notified and is working to fix the issue. 
                    Please try again in a few moments.
                </p>

                <!-- Status Information -->
                <div class="alert alert-warning mb-4">
                    <div class="d-flex align-items-center">
                        <i class="bi bi-info-circle me-2"></i>
                        <span>We're experiencing technical difficulties. Please try again later.</span>
                    </div>
                </div>

                <!-- Recovery Actions -->
                <div class="row g-3 mb-4">
                    <div class="col-md-6">
                        <div class="card h-100 border-0 shadow-sm">
                            <div class="card-body text-center">
                                <i class="bi bi-arrow-clockwise fs-1 text-africoin mb-3"></i>
                                <h5 class="card-title">Refresh Page</h5>
                                <p class="card-text text-muted small">Try reloading the page</p>
                                <button class="btn btn-outline-africoin btn-sm" onclick="window.location.reload()">
                                    Refresh
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card h-100 border-0 shadow-sm">
                            <div class="card-body text-center">
                                <i class="bi bi-house-door fs-1 text-africoin mb-3"></i>
                                <h5 class="card-title">Go Home</h5>
                                <p class="card-text text-muted small">Return to the homepage</p>
                                <a href="{{ url_for('index') }}" class="btn btn-outline-africoin btn-sm">Home</a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- System Status -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-light">
                        <h6 class="mb-0">
                            <i class="bi bi-speedometer2 me-2"></i>System Status
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-4">
                                <div class="status-item">
                                    <div class="status-indicator bg-success" id="apiStatus"></div>
                                    <small class="text-muted">API</small>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="status-item">
                                    <div class="status-indicator bg-success" id="dbStatus"></div>
                                    <small class="text-muted">Database</small>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="status-item">
                                    <div class="status-indicator bg-warning" id="serviceStatus"></div>
                                    <small class="text-muted">Services</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Technical Details -->
                <div class="alert alert-light border">
                    <small class="text-muted">
                        <strong>What to do now?</strong><br>
                        • Refresh the page and try again<br>
                        • Clear your browser cache and cookies<br>
                        • Check our <a href="#" class="text-africoin">status page</a> for updates<br>
                        • Wait a few minutes and try again<br>
                        <br>
                        <strong>Error Details:</strong><br>
                        • Error: 500 - Internal Server Error<br>
                        • Timestamp: <span id="timestamp"></span><br>
                        • Request ID: <code id="requestId">#{{ range(100000, 999999) | random }}</code>
                    </small>
                </div>

                <!-- Emergency Contact -->
                <div class="mt-4 p-3 bg-light rounded">
                    <h6 class="mb-2">Need Immediate Assistance?</h6>
                    <p class="text-muted small mb-2">
                        If this error persists, please contact our support team immediately.
                    </p>
                    <div class="d-flex justify-content-center gap-2">
                        <a href="mailto:support@africoin.com?subject=Urgent: 500 Server Error" 
                           class="btn btn-sm btn-outline-danger">
                            <i class="bi bi-envelope me-1"></i>Email Support
                        </a>
                        <button class="btn btn-sm btn-outline-africoin" onclick="showLiveChat()">
                            <i class="bi bi-chat-dots me-1"></i>Live Chat
                        </button>
                    </div>
                </div>

                <!-- Progress Indicator for Auto-Retry -->
                <div class="mt-4" id="autoRetrySection" style="display: none;">
                    <div class="d-flex align-items-center justify-content-center mb-2">
                        <div class="spinner-border spinner-border-sm text-africoin me-2" role="status"></div>
                        <span class="text-muted">Auto-retrying in <span id="countdown">10</span> seconds...</span>
                    </div>
                    <button class="btn btn-sm btn-outline-secondary" onclick="cancelAutoRetry()">Cancel Auto-Retry</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Display timestamp
    document.getElementById('timestamp').textContent = new Date().toLocaleString();

    // Simulate system status check
    function checkSystemStatus() {
        // Simulate API status (usually this would be an actual API call)
        setTimeout(() => {
            document.getElementById('apiStatus').className = 'status-indicator bg-success';
        }, 1000);

        // Simulate DB status
        setTimeout(() => {
            document.getElementById('dbStatus').className = 'status-indicator bg-success';
        }, 1500);

        // Simulate service status (showing warning for 500 error)
        setTimeout(() => {
            document.getElementById('serviceStatus').className = 'status-indicator bg-warning';
        }, 2000);
    }

    // Auto-retry functionality
    let countdown = 10;
    let countdownInterval;

    function startAutoRetry() {
        document.getElementById('autoRetrySection').style.display = 'block';
        countdownInterval = setInterval(() => {
            countdown--;
            document.getElementById('countdown').textContent = countdown;
            
            if (countdown <= 0) {
                clearInterval(countdownInterval);
                window.location.reload();
            }
        }, 1000);
    }

    function cancelAutoRetry() {
        clearInterval(countdownInterval);
        document.getElementById('autoRetrySection').style.display = 'none';
    }

    function showLiveChat() {
        alert('Live chat feature would open here. In a real application, this would connect to your chat service.');
    }

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', function() {
        checkSystemStatus();
        
        // Start auto-retry after 5 seconds
        setTimeout(startAutoRetry, 5000);
    });

    // Add some CSS for status indicators
    const style = document.createElement('style');
    style.textContent = `
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-bottom: 4px;
        }
        .status-item {
            padding: 10px;
        }
        .error-content {
            animation: fadeInUp 0.6s ease-out;
        }
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    `;
    document.head.appendChild(style);
</script>
{% endblock %}